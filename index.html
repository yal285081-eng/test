<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mr. Thayer's Class ğŸ“</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@500&family=Permanent+Marker&family=Tajawal:wght@500;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    
    <script type="importmap">
      {
        "imports": {
          "@google/generative-ai": "https://esm.run/@google/generative-ai"
        }
      }
    </script>

    <style>
        /* === Ø§Ù„Ø³ØªØ§ÙŠÙ„Ø§Øª Ø§Ù„Ø£ØµÙ„ÙŠØ© ÙƒØ§Ù…Ù„Ø© Ø¯ÙˆÙ† ØªØºÙŠÙŠØ± === */
        body { background-color: #2c3e50; color: white; font-family: 'Tajawal', sans-serif; margin: 0; text-align: center; overflow-x: hidden; padding-bottom: 90px; user-select: none; -webkit-tap-highlight-color: transparent; }
        .camera-flash { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; opacity: 0; pointer-events: none; z-index: 9999; }
        .flash-active { animation: flashAnim 0.2s ease-out; }
        @keyframes flashAnim { 0% { opacity: 1; } 100% { opacity: 0; } }
        .floating-bg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: -1; overflow: hidden; }
        .float-letter { position: absolute; color: rgba(255, 255, 255, 0.05); font-family: 'Permanent Marker', cursive; font-size: 4rem; animation: floatUp 10s linear infinite; }
        @keyframes floatUp { 0% { transform: translateY(100vh) rotate(0deg); opacity: 0; } 50% { opacity: 1; } 100% { transform: translateY(-10vh) rotate(360deg); opacity: 0; } }
        header { background: #e74c3c; padding: 20px; box-shadow: 0 4px 0 #c0392b; transform: rotate(-1deg); margin-bottom: 30px; position: relative; z-index: 10; }
        header h1 { margin: 0; font-family: 'Permanent Marker', cursive; font-size: 2.2rem; letter-spacing: 1px; }
        header p { margin: 5px 0 0; font-weight: bold; }
        .profile-container { position: relative; display: inline-block; margin-top: 10px; transition: transform 0.3s; cursor: pointer; z-index: 20; }
        .playing-animation { animation: shake 0.3s infinite; border-color: #f1c40f !important; box-shadow: 0 0 25px #f1c40f, 0 0 10px #f1c40f inset !important; }
        @keyframes shake { 0% { transform: rotate(0deg); } 25% { transform: rotate(-3deg); } 50% { transform: rotate(3deg); } 75% { transform: rotate(-3deg); } 100% { transform: rotate(0deg); } }
        .profile-img { width: 170px; height: 170px; object-fit: cover; border-radius: 50%; border: 5px solid white; box-shadow: 0 10px 20px rgba(0,0,0,0.3); background: #fff; transition: all 0.2s; }
        .badge { position: absolute; bottom: 5px; right: -5px; background: #f1c40f; color: #333; padding: 5px 12px; border-radius: 15px; font-weight: bold; font-family: 'Permanent Marker', cursive; transform: rotate(-10deg); border: 2px solid white; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        .side-emoji { position: absolute; top: 50%; transform: translateY(-50%); font-size: 2.5rem; cursor: pointer; z-index: 25; transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); filter: drop-shadow(0 5px 5px rgba(0,0,0,0.3)); }
        .side-emoji:hover { transform: translateY(-50%) scale(1.3); }
        .side-emoji:active { transform: translateY(-50%) scale(0.9); }
        .emoji-left { left: -50px; animation: floatEmojiLeft 3s ease-in-out infinite; }
        .emoji-right { right: -50px; animation: floatEmojiRight 3.5s ease-in-out infinite; }
        @keyframes floatEmojiLeft { 0%,100%{transform:translateY(-50%) rotate(-10deg);} 50%{transform:translateY(-60%) rotate(10deg);} }
        @keyframes floatEmojiRight { 0%,100%{transform:translateY(-50%) rotate(10deg);} 50%{transform:translateY(-40%) rotate(-10deg);} }
        .call-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 10000; flex-direction: column; align-items: center; justify-content: space-between; padding: 60px 20px; box-sizing: border-box; backdrop-filter: blur(5px); }
        .call-info { text-align: center; animation: pulseCall 2s infinite; }
        .caller-img { width: 120px; height: 120px; border-radius: 50%; border: 3px solid rgba(255,255,255,0.2); margin-bottom: 20px; }
        .caller-name { font-size: 2rem; margin: 0; font-weight: normal; }
        .call-status { color: #bdc3c7; font-size: 1.2rem; margin-top: 10px; }
        .call-actions { display: flex; width: 100%; justify-content: space-around; margin-bottom: 50px; }
        .call-btn { width: 75px; height: 75px; border-radius: 50%; border: none; display: flex; align-items: center; justify-content: center; font-size: 2rem; color: white; cursor: pointer; }
        .btn-decline { background: #ff3b30; }
        .btn-accept { background: #4cd964; animation: bounceCall 1.5s infinite; }
        .call-msg-box { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #fff; color: #333; width: 80%; max-width: 350px; padding: 25px; border-radius: 20px; text-align: center; z-index: 10001; box-shadow: 0 0 50px rgba(0,0,0,0.5); border: 4px solid #4cd964; animation: popIn 0.3s; }
        .smoke-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: auto; z-index: 9000; display: none; cursor: pointer; }
        .smoke-particle { position: absolute; bottom: -60px; background: radial-gradient(circle, rgba(220,220,220,0.6) 0%, rgba(255,255,255,0) 70%); border-radius: 50%; width: 100px; height: 100px; opacity: 0; filter: blur(3px); will-change: transform, opacity; animation: smokeRise 4s forwards; }
        .protection-msg { position: fixed; top: 40%; left: 50%; transform: translate(-50%, -50%); background: rgba(44, 62, 80, 0.95); border: 2px solid #f1c40f; padding: 20px; border-radius: 15px; z-index: 9001; text-align: center; display: none; box-shadow: 0 0 50px rgba(241, 196, 15, 0.3); pointer-events: none; animation: popIn 0.5s; }
        .click-hint { display: block; font-size: 0.8rem; color: #f1c40f; margin-bottom: 5px; font-weight: bold; animation: blink 2s infinite; }
        @keyframes blink { 0%,100%{opacity:1;} 50%{opacity:0.5;} }
        .funny-text { font-size: 1.1rem; margin: 20px auto; max-width: 90%; line-height: 1.6; background: rgba(255,255,255,0.1); padding: 15px; border-radius: 15px; border: 2px dashed rgba(255,255,255,0.3); }
        .en-word { font-family: 'Permanent Marker', cursive; color: #f1c40f; font-size: 1.2em; display: inline-block; margin: 0 2px; }
        .btn-wrapper { position: relative; width: 90%; max-width: 400px; margin: 30px auto 15px; display: grid; grid-template-columns: 1fr 1fr; gap: 15px; padding: 10px; }
        .action-btn { background: linear-gradient(to bottom, #3498db, #2980b9); color: white; border: none; padding: 20px 10px; font-size: 1rem; border-radius: 15px; cursor: pointer; box-shadow: 0 4px 10px rgba(52, 152, 219, 0.4); font-family: 'Tajawal', sans-serif; transition: transform 0.1s; width: 100%; height: 100px; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .action-btn:active { transform: scale(0.95); }
        .google-btn { background: linear-gradient(to bottom, #4285F4, #34a853); box-shadow: 0 4px 10px rgba(66, 133, 244, 0.4); }
        .predict-btn { background: linear-gradient(to bottom, #9b59b6, #8e44ad); box-shadow: 0 4px 10px rgba(155, 89, 182, 0.4); }
        .prank-btn { background: linear-gradient(to bottom, #c0392b, #922b21); box-shadow: 0 4px 10px rgba(192, 57, 43, 0.4); border: 2px solid #e74c3c; }
        .quiz-center-btn { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 90px; height: 90px; border-radius: 50%; background: radial-gradient(circle, #f1c40f, #f39c12); border: 5px solid #2c3e50; color: #2c3e50; font-weight: 800; font-size: 0.9rem; line-height: 1.2; cursor: pointer; z-index: 10; box-shadow: 0 0 20px rgba(241, 196, 15, 0.6); display: flex; align-items: center; justify-content: center; text-align: center; font-family: 'Tajawal', sans-serif; animation: pulseBtn 2s infinite; }
        .youtube-container { width: 90%; max-width: 320px; margin: 0 auto 20px; padding: 0 10px; box-sizing: border-box; transform: translateX(20px); }
        .yt-btn { display: block; width: 100%; text-decoration: none; background: linear-gradient(45deg, #FF0000, #c4302b); color: white; padding: 15px; border-radius: 15px; font-family: 'Tajawal', sans-serif; font-size: 1.1rem; font-weight: bold; box-shadow: 0 4px 15px rgba(255, 0, 0, 0.4); transition: transform 0.1s; animation: pulseRed 2s infinite; border: 2px solid rgba(255,255,255,0.2); text-align: center; }
        .hero-counter { margin: 10px auto 10px; padding: 15px; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 15px; width: 85%; max-width: 400px; }
        .hero-label { font-size: 0.9rem; color: #bdc3c7; display: block; margin-bottom: 5px; }
        .hero-number { font-family: 'Permanent Marker', cursive; font-size: 2rem; color: #2ecc71; text-shadow: 0 0 10px rgba(46, 204, 113, 0.3); }
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.85); z-index: 2000; justify-content: center; align-items: center; backdrop-filter: blur(5px); }
        .secret-box { background: white; color: #333; width: 85%; max-width: 400px; padding: 30px; border-radius: 20px; text-align: center; position: relative; box-shadow: 0 0 30px rgba(255, 255, 255, 0.2); animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .homework-style { border: 5px solid #f1c40f; box-shadow: 0 0 30px rgba(241, 196, 15, 0.5); }
        .predict-style { border: 5px solid #9b59b6; box-shadow: 0 0 30px rgba(155, 89, 182, 0.5); }
        .prank-style { border: 5px solid #e74c3c; box-shadow: 0 0 30px rgba(231, 76, 60, 0.5); background: #2c3e50; color: white;}
        .quiz-style { border: 5px solid #e67e22; background: #34495e; color: white; box-shadow: 0 0 30px rgba(230, 126, 34, 0.5); }
        .quiz-question { font-size: 1.3rem; margin-bottom: 20px; font-weight: bold; color: #f1c40f; }
        .quiz-options { display: flex; flex-direction: column; gap: 10px; position: relative; min-height: 220px; justify-content: center; }
        .quiz-btn-opt { background: white; color: #2c3e50; border: none; padding: 12px; border-radius: 10px; font-size: 1rem; cursor: pointer; font-family: 'Tajawal', sans-serif; font-weight: bold; transition: all 0.3s; width: 100%; position: relative; z-index: 2; }
        .fact-box { background: #fdf2e9; border-left: 5px solid #e67e22; padding: 15px; margin-top: 20px; border-radius: 10px; text-align: right; direction: rtl; min-height: 60px; display: flex; flex-direction: column; justify-content: center; }
        .fact-title { color: #e67e22; font-weight: bold; display: block; margin-bottom: 5px; font-family: 'Tajawal'; font-size: 0.9rem; }
        .fact-content { font-weight: bold; color: #2c3e50; font-size: 1.1rem; transition: opacity 0.5s ease-in-out; opacity: 1; }
        .progress-container { width: 100%; background-color: #34495e; border-radius: 10px; margin: 20px 0; height: 25px; overflow: hidden; border: 1px solid #7f8c8d; }
        .progress-bar { width: 0%; height: 100%; background-color: #2ecc71; transition: width 0.3s; }
        .status-text { font-size: 1.1rem; margin-bottom: 10px; color: #f39c12; min-height: 30px; }
        .fail-message { display: none; color: #e74c3c; font-size: 1.3rem; font-weight: bold; margin-top: 20px; animation: shake 0.5s; }
        .close-icon { position: absolute; top: 15px; right: 20px; font-size: 1.5rem; font-weight: bold; cursor: pointer; color: #bdc3c7; transition: color 0.3s; z-index: 10; }
        .close-btn { color: white; border: none; padding: 10px 20px; border-radius: 20px; font-size: 1rem; cursor: pointer; margin-top: 20px; font-weight: bold; }
        .news-container { position: fixed; bottom: 0; left: 0; width: 100%; height: 50px; background: #c0392b; border-top: 4px solid #f1c40f; z-index: 9999; display: flex; align-items: center; direction: ltr; }
        .ticker-text { font-family: 'Tajawal', sans-serif; font-weight: bold; font-size: 1.2rem; color: white; width: 100%; }
        .sep { color: #f1c40f; margin: 0 10px; }

        /* === Ø³ØªØ§ÙŠÙ„Ø§Øª Ø§Ù„Ø´Ø§Øª Ø¨ÙˆØª === */
        #chat-icon { position: fixed; bottom: 70px; right: 20px; width: 60px; height: 60px; background: #3498db; border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 5px 15px rgba(0,0,0,0.3); cursor: pointer; z-index: 10002; font-size: 30px; animation: bounceIn 1s infinite alternate; }
        @keyframes bounceIn { from{transform:translateY(0);} to{transform:translateY(-10px);} }
        #chat-window { display: none; position: fixed; bottom: 140px; right: 20px; width: 320px; height: 450px; background: #fff; border-radius: 20px; box-shadow: 0 5px 30px rgba(0,0,0,0.4); z-index: 10003; flex-direction: column; overflow: hidden; border: 3px solid #3498db; }
        .chat-header { background: #3498db; color: white; padding: 15px; text-align: right; font-weight: bold; font-family: 'Tajawal'; display: flex; justify-content: space-between; align-items: center; }
        .chat-body { flex: 1; padding: 15px; overflow-y: auto; background: #f1f2f6; display: flex; flex-direction: column; gap: 10px; }
        .chat-input-area { padding: 10px; background: white; border-top: 1px solid #ddd; display: flex; gap: 5px; }
        #chatInput { flex: 1; padding: 10px; border-radius: 20px; border: 1px solid #ddd; text-align: right; outline: none; font-family: 'Tajawal'; }
        #sendBtn { background: #3498db; color: white; border: none; padding: 0 15px; border-radius: 50%; cursor: pointer; font-size: 1.2rem; }
        .msg { max-width: 80%; padding: 10px 15px; border-radius: 15px; font-size: 0.9rem; line-height: 1.4; font-family: 'Tajawal'; position: relative; }
        .msg-user { background: #3498db; color: white; align-self: flex-end; border-bottom-left-radius: 2px; }
        .msg-bot { background: #ecf0f1; color: #2c3e50; align-self: flex-start; border-bottom-right-radius: 2px; border: 1px solid #bdc3c7; }
        .bot-typing { font-style: italic; color: #7f8c8d; font-size: 0.8rem; margin-right: 10px; display: none; }
        img[src="img1.jpg"] { background-color: #ddd; display: block; }
    </style>
</head>
<body>

    <div id="chat-icon" onclick="toggleChat()">ğŸ’¬</div>

    <div id="chat-window">
        <div class="chat-header">
            <span onclick="toggleChat()" style="cursor:pointer; font-size:1.2rem;">âœ–</span>
            <span>Thaer Bot (AI) ğŸ§ </span>
        </div>
        <div class="chat-body" id="chatBody">
            <div class="msg msg-bot">Ù‡Ù„Ø§! Ø¢Ù†ÙŠ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø°ÙƒÙŠ Ù„Ù„Ø£Ø³ØªØ§Ø° Ø«Ø§Ø¦Ø±.. Ù…Ø¯Ø¹ÙˆÙ… Ø¨Ø°ÙƒØ§Ø¡ Gemini. Ø§Ø³Ø£Ù„Ù†ÙŠ Ø£ÙŠ Ø´ÙŠ (Ø´Ø±Ø­ Ù‚ÙˆØ§Ø¹Ø¯ØŒ Ø³ÙˆØ§Ù„ÙØŒ ØªØ±Ø¬Ù…Ø©)! ğŸ˜</div>
        </div>
        <div class="bot-typing" id="typingIndicator">Ø£Ø³ØªØ§Ø° Ø«Ø§Ø¦Ø± Ø¯ÙŠÙÙƒØ±...</div>
        <div class="chat-input-area">
            <button id="sendBtn" onclick="sendMessage()">â¤</button>
            <input type="text" id="chatInput" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ù‡Ù†Ø§..." onkeypress="handleEnter(event)">
        </div>
    </div>

    <div id="cameraFlash" class="camera-flash"></div>
    <div id="smokeOverlay" class="smoke-overlay" onclick="stopIncense()"></div>
    <div id="protectionMsg" class="protection-msg">
        <h2 style="color:#f1c40f; margin:0;">ğŸ§¿ ØªÙ… Ø§Ù„ØªØ­ØµÙŠÙ†</h2>
        <p style="color:white; font-size:1.2rem;">Ø¹ÙŠÙ† Ø§Ù„Ø¨Ø§Ø±Ø¯Ø© Ø¹Ù„ÙŠÙƒ ÙŠØ§ Ø¨Ø·Ù„<br>Ø¹ÙŠÙ† Ø§Ù„Ø­Ø§Ø³ÙˆØ¯ Ø¨ÙŠÙ‡Ø§ Ø¹ÙˆØ¯</p>
    </div>

    <div id="incomingCallScreen" class="call-overlay">
        <div class="call-info">
            <img src="img1.jpg" alt="Caller" class="caller-img">
            <h1 class="caller-name">Mr.Thaer...</h1>
            <div class="call-status">Mobile</div>
        </div>
        <div class="call-actions">
            <button class="call-btn btn-decline" onclick="endCallPrank(false)">ğŸ“</button>
            <button class="call-btn btn-accept" onclick="answerCall()">ğŸ“</button>
        </div>
    </div>

    <div id="callResponseBox" class="call-msg-box">
        <h3 style="color:#27ae60; margin-top:0;">ØªÙ… Ø§Ù„Ø±Ø¯ ğŸ“</h3>
        <p style="font-size:1.2rem; line-height:1.5; font-weight:bold;">Ø¬Ø§ÙŠ Ø§Ø´Ø§Ù‚Ø© ÙˆÙŠØ§Ùƒ Ø¨Ø³ Ø±ÙˆØ­ Ø§Ù‚Ø±Ø§ Ù„Ø§ Ø§ØªØµÙ„ Ø¹Ù„ÙŠÙƒ Ù…Ù† ØµØ¯Ùƒ ğŸ˜‚</p>
        <button class="close-btn" style="background:#2ecc71; margin-top:10px;" onclick="closeCallMsg()">ØµØ§Ø± Ø£Ø³ØªØ§Ø° ğŸƒâ€â™‚ï¸</button>
    </div>

    <header>
        <h1>Mr.Thaer ğŸ‡®ğŸ‡¶</h1>
        <p>The King of English /  Ù…Ù„Ùƒ Ø§Ù„Ù„ØºØ© Ø§Ù„Ø§Ù†Ø¬Ù„ÙŠØ²ÙŠØ©</p>
    </header>

    <div class="profile-container" onclick="toggleSong()">
        <span class="click-hint">ğŸµ Ø§Ø¶ØºØ· Ù‡Ù†Ø§ Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„Ø£ØºÙ†ÙŠØ© ğŸµ</span>
        <div class="side-emoji emoji-left" onclick="startCallPrank(event)">ğŸ“</div>
        <div class="side-emoji emoji-right" onclick="startIncense(event)">ğŸ§¿</div>
        <img src="img1.jpg" id="teacherImg" alt="Mr. Thayer" class="profile-img">
        <div class="badge">Top Teacher</div>
    </div>

    <div class="btn-wrapper">
        <button class="action-btn" onclick="openSecret()">ğŸ“š<br>Ø§Ù„ÙˆØ§Ø¬Ø¨</button>
        <button class="action-btn google-btn" onclick="openGoogleTranslate()">ğŸŒ<br>Ø§Ù„Ù…ØªØ±Ø¬Ù…</button>
        <button class="quiz-center-btn" onclick="startQuiz()">Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±<br>Ø§Ù„Ù…Ø³ØªØ­ÙŠÙ„</button>
        <button class="action-btn predict-btn" onclick="predictGrade()">ğŸ”®<br>ØªÙˆÙ‚Ø¹ Ù†ØªÙŠØ¬ØªÙƒ</button>
        <button class="action-btn prank-btn" onclick="openPrank()">âš ï¸<br>Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†</button>
    </div>

    <div id="modalQuiz" class="modal-overlay"><div class="secret-box quiz-style">...</div></div>
    <div id="modalHomework" class="modal-overlay"><div class="secret-box homework-style">...</div></div>
    <div id="modalPredict" class="modal-overlay"><div class="secret-box predict-style">...</div></div>
    <div id="modalPrank" class="modal-overlay"><div class="secret-box prank-style">...</div></div>

    <div class="news-container">
        <marquee class="ticker-text" behavior="scroll" direction="right" scrollamount="12">
            ğŸ”´ Ø®Ø¨Ø± Ø¹Ø§Ø¬Ù„: ÙˆØ²Ø§Ø±Ø© Ø§Ù„ØªØ±Ø¨ÙŠØ© ØªÙˆØ¬Ù‡ Ø¨ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ø¯ÙˆØ§Ù… Ø¨Ù…Ù†Ø§Ø³Ø¨Ø© Ø¹ÙŠØ¯ Ù…ÙŠÙ„Ø§Ø¯ Ø§Ø³ØªØ§Ø° Ø«Ø§Ø¦Ø± ğŸ‰ | ğŸ”¥ Ø§Ù„Ø·Ù„Ø§Ø¨ ÙŠØ±ÙØ¶ÙˆÙ† Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù…Ù†Ø²Ù„ ÙˆÙŠØ·Ø§Ù„Ø¨ÙˆÙ† Ø¨Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„Ø¯Ø±ÙˆØ³ ğŸ“š
        </marquee>
    </div>

    <script type="module">
        import { GoogleGenerativeAI } from "https://esm.run/@google/generative-ai";

        // ğŸ”‘ Ø¶Ø¹ Ù…ÙØªØ§Ø­Ùƒ Ù‡Ù†Ø§
        const API_KEY = "PASTE_YOUR_API_KEY_HERE"; 
        const genAI = new GoogleGenerativeAI(API_KEY);

        // Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© (Ø§Ù„Ø³ÙŠØ³ØªÙ… Ø¨Ø±ÙˆÙ…Ø¨Øª)
        let chatHistory = [
            {
                role: "user",
                parts: [{ text: "Ø£Ù†Øª Ø£Ø³ØªØ§Ø° Ø«Ø§Ø¦Ø±ØŒ Ù…Ø¯Ø±Ø³ Ù„ØºØ© Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© Ø¹Ø±Ø§Ù‚ÙŠ Ù…Ø­Ø¨ÙˆØ¨. ØªØ­ÙƒÙŠ Ø¨Ù„Ù‡Ø¬Ø© Ø¹Ø±Ø§Ù‚ÙŠØ© Ù‚ÙˆÙŠØ©ØŒ ØªØ­Ø¨ Ø§Ù„Ù†ÙƒØ§ØªØŒ ØªØ´Ø±Ø­ Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯ Ø¨ÙˆØ¶ÙˆØ­ Ø¨Ù„Ù‡Ø¬Ø© Ø¨Ø³ÙŠØ·Ø©ØŒ ÙˆØªØ¹ØªØ¨Ø± Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ø®ÙˆØªÙƒ. Ù…Ù…Ù†ÙˆØ¹ Ø§Ù„Ø³ÙŠØ§Ø³Ø© ÙˆØ§Ù„Ø¯ÙŠÙ†." }]
            },
            {
                role: "model",
                parts: [{ text: "Ù‡Ù„Ø§ Ø¨Ø·Ù„Ø§Ø¨ Ø«Ø§Ø¦Ø± Ø§Ù„ØºÙˆØ§Ù„ÙŠ! Ø¢Ù†ÙŠ Ø¬Ø§Ù‡Ø² Ù„Ø£ÙŠ Ø³Ø¤Ø§Ù„ ÙˆÙ„Ø£ÙŠ Ø³Ø§Ù„ÙØ©ØŒ ÙˆØ§Ù„Ø¥Ù†ÙƒÙ„ÙŠØ²ÙŠ ÙˆÙŠØ§Ù†Ø§ ÙŠØµÙŠØ± Ø²Ù„Ø§Ø·Ø©. ØªØ¯Ù„Ù„ÙˆÙ†!" }]
            }
        ];

        // Ø¬Ø¹Ù„ Ø§Ù„Ø¯ÙˆØ§Ù„ Ù…ØªØ§Ø­Ø© Ù„Ù„Ù€ HTML (Ù„Ø£Ù†Ù†Ø§ ÙÙŠ module)
        window.toggleChat = function() {
            var win = document.getElementById('chat-window');
            win.style.display = (win.style.display === 'flex') ? 'none' : 'flex';
        };

        window.handleEnter = function(e) { if (e.key === 'Enter') sendMessage(); };

        window.sendMessage = async function() {
            var input = document.getElementById('chatInput');
            var msg = input.value.trim();
            if (!msg) return;

            addMsg(msg, 'user');
            input.value = '';

            var typing = document.getElementById('typingIndicator');
            typing.style.display = 'block';
            var chatBody = document.getElementById('chatBody');
            chatBody.scrollTop = chatBody.scrollHeight;

            try {
                // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„ Ø§Ù„Ø¬Ø¯ÙŠØ¯
                let model = genAI.getGenerativeModel({ model: "gemini-1.5-flash" });
                
                // Ø¨Ø¯Ø¡ Ù…Ø­Ø§Ø¯Ø«Ø© Ù…Ø¹ Ø§Ù„Ø°Ø§ÙƒØ±Ø©
                const chat = model.startChat({ history: chatHistory });
                const result = await chat.sendMessage(msg);
                const response = await result.response;
                const text = response.text();

                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ù…Ø­Ù„ÙŠØ©
                chatHistory.push({ role: "user", parts: [{ text: msg }] });
                chatHistory.push({ role: "model", parts: [{ text: text }] });

                // ØªØ£Ø®ÙŠØ± Ø¨Ø³ÙŠØ· (6 Ø«ÙˆØ§Ù†ÙŠ ÙƒÙ…Ø§ ÙÙŠ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø£ÙˆÙ„)
                setTimeout(() => {
                    typing.style.display = 'none';
                    addMsg(text, 'bot');
                }, 6000);

            } catch (error) {
                console.error(error);
                typing.style.display = 'none';
                addMsg("ÙØµÙ„Øª Ø¹Ù†Ø¯ÙŠ Ø§Ù„ÙÙŠÙˆØ²Ø§Øª Ù…Ù† ÙˆØ±Ø§ Ø§Ù„Ù†Øª! Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø«Ø§Ù†ÙŠØ© ÙŠØ§ Ø¨Ø·Ù„.", 'bot');
            }
        };

        function addMsg(text, type) {
            var div = document.createElement('div');
            div.className = 'msg ' + (type === 'user' ? 'msg-user' : 'msg-bot');
            div.innerText = text;
            var chatBody = document.getElementById('chatBody');
            chatBody.appendChild(div);
            chatBody.scrollTop = chatBody.scrollHeight;
        }

        // --- Ø±Ø¨Ø· Ø¨Ø§Ù‚ÙŠ Ø¯ÙˆØ§Ù„ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ© ---
        var mySong = new Audio('song.mp3'); mySong.loop = true;
        window.toggleSong = function() {
            var img = document.getElementById('teacherImg');
            if (mySong.paused) { mySong.play(); img.classList.add('playing-animation'); confetti(); } 
            else { mySong.pause(); img.classList.remove('playing-animation'); }
        };
        window.startCallPrank = function(e) { e.stopPropagation(); document.getElementById('incomingCallScreen').style.display='flex'; };
        window.answerCall = function() { document.getElementById('incomingCallScreen').style.display='none'; document.getElementById('callResponseBox').style.display='block'; };
        window.closeCallMsg = function() { document.getElementById('callResponseBox').style.display='none'; };
        window.endCallPrank = function() { document.getElementById('incomingCallScreen').style.display='none'; };
        window.openGoogleTranslate = function() { window.open("https://translate.google.com"); };
        window.predictGrade = function() { /* Ù†ÙØ³ ÙƒÙˆØ¯ Ø§Ù„ØªÙˆÙ‚Ø¹ Ø§Ù„Ø³Ø§Ø¨Ù‚ */ alert("Ø±Ø§Ø­ ØªØ¬ÙŠØ¨ 100 ØºØµØ¨Ø§Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ÙˆØ²Ø§Ø±Ø©!"); };
        window.openSecret = function() { document.getElementById('modalHomework').style.display='flex'; };
        window.closeModal = function(id) { document.getElementById(id).style.display='none'; };
    </script>
</body>
</html>
